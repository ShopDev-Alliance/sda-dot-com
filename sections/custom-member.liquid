{% liquid
  assign show_profile = metaobject.profile.value | default: false
  assign contact_url = metaobject.alternative_contact | default: metaobject.website

  assign utm_params_profile = 'utm_source=shopdev-alliance&utm_medium=referral&utm_campaign=member-profile'

  assign website_link_url = ''
  if metaobject.website != blank
    if metaobject.website.value contains '?'
      assign website_link_url = metaobject.website.value | append: '&' | append: utm_params_profile
    else
      assign website_link_url = metaobject.website.value | append: '?' | append: utm_params_profile
    endif
  endif

  assign contact_link_url = ''
  if contact_url != blank
    if contact_url.value contains '?'
      assign contact_link_url = contact_url.value | append: '&' | append: utm_params_profile
    else
      assign contact_link_url = contact_url.value | append: '?' | append: utm_params_profile
    endif
  endif
%}

{% if show_profile %}
  <section id="profile-page" class="page-width">
    <div class="profile-container">
      <div class="profile-left">
        <div class="profile-left--container">
          {% unless metaobject.profile_photo == blank %}
            <div class="profile-left--image">
              {{ metaobject.profile_photo.value | image_url: width: 350 | image_tag: widths: '350, 500, 650', sizes: '(max-width: 650px) 350px' }}
            </div>
          {% endunless %}
          <div class="profile-left--info">
            <h1 class="profile-left--name">{{ metaobject.name.value }}</h1>
            {% unless metaobject.tagline == blank %}
              <p class="profile-left--tag">{{ metaobject.tagline.value }}</p>
            {% endunless %}
            {% unless metaobject.open_to_work == blank %}
              {% render 'badge-dot', text: 'Open to work' %}
            {% endunless %}
            {% unless metaobject.working_hours == blank %}
              <h3 class="h4">Working hours availability:</h3>
              <p class="profile-left--working_hours">{{ metaobject.working_hours.value }}</p>
            {% endunless %}
          </div>
          <div class="profile-left--socials">
            <ul class="list-unstyled">
              {% unless metaobject.website == blank %}
                <li class="list-social__item">
                  <a class="link list-social__link" href="{{ website_link_url }}" target="_blank">{% render 'icon-website' %}
                    <span class="visually-hidden">Website</span>
                  </a>
                </li>
              {% endunless %}
              {% unless metaobject.twitter == blank %}
                <li class="list-social__item">
                  <a class="link list-social__link" href="{{ metaobject.twitter.value }}" target="_blank">{% render 'icon-twitter' %}
                    <span class="visually-hidden">Twitter</span>
                  </a>
                </li>
              {% endunless %}
              {% unless metaobject.linked_in == blank %}
                <li class="list-social__item">
                  <a class="link list-social__link" href="{{ metaobject.linked_in.value }}" target="_blank">{% render 'icon-linkedin' %}
                    <span class="visually-hidden">LinkedIn</span>
                  </a>
                </li>
              {% endunless %}
              {% unless metaobject.github == blank %}
                <li class="list-social__item">
                  <a class="link list-social__link" href="{{ metaobject.github.value }}" target="_blank">{% render 'icon-github' %}
                    <span class="visually-hidden">Github</span>
                  </a>
                </li>
              {% endunless %}
              {% unless metaobject.you_tube == blank %}
                <li class="list-social__item">
                  <a class="link list-social__link" href="{{ metaobject.you_tube.value }}" target="_blank">{% render 'icon-youtube' %}
                    <span class="visually-hidden">YouTube</span>
                  </a>
                </li>
              {% endunless %}
            </ul>
          </div>
          {% if contact_url != null %}
            <div class="profile-left--cta">
              <a class="button button--primary" href="{{ contact_link_url }}">Contact</a>
            </div>
          {% endif %}
        </div>
      </div>
      <div class="profile-right">
        {% liquid
          capture metaobject_description
            echo metaobject.description | metafield_tag | strip_html
          endcapture
          assign description_classes = 'profile-right--bio'
          if metaobject_description.size > 500
            assign description_classes = description_classes | append: ' long-description description--hidden'
          endif
          if metaobject.description == blank
            assign description_classes = description_classes | append: ' description--empty'
          endif
        %}
        <div class="{{ description_classes }}">
          <h2>About</h2>
          {{ metaobject.description | metafield_tag }}
        </div>
        <button class="js-show-more button button--secondary">Read more</button>
        {% unless metaobject.languages == blank %}
          <h3 class="h4">Language Fluency</h3>
          <ul>
            {% unless metaobject.languages == blank %}
              {% for language in metaobject.languages.value %}
                <li>{{ language }}</li>
              {% endfor %}
            {% endunless %}
          </ul>
        {% endunless %}
        <h3>Services</h3>
          <p class="h4">Primary service: <span class="h4">{{ metaobject.primary_service.value }}</span></p>
        <ul>
          {% unless metaobject.services == blank %}
            <h4 class="subtle-header">Other Services</h4>
            {% for service in metaobject.services.value %}
              <li>{{ service }}</li>
            {% endfor %}
          {% endunless %}
        </ul>
        {% unless metaobject.additional_services == blank %}
          <h4>Shopify Services and Experience</h4>
          {{ metaobject.additional_services | metafield_tag }}
        {% endunless %}

        {% unless metaobject.technologies == blank %}
          <h3>Skills and Technologies</h3>
          <ul>
            {% for technology in metaobject.technologies.value %}
              <li>{{ technology }}</li>
            {% endfor %}
          </ul>
        {% endunless %}
        {% unless metaobject.skills_and_technologies_additional_notes == blank %}
          <h4>Skills and Technologies Notes</h4>
          {{ metaobject.skills_and_technologies_additional_notes | metafield_tag }}
        {% endunless %}


        {% unless metaobject.portfolio_sites == blank %}
          <h3>Portfolio References</h3>
          {{ metaobject.portfolio_sites | metafield_tag }}
        {% endunless %}
        {% if metaobject.reviews != blank %}
          <div class="profile-right--reviews">
              <h3>Reviews</h3>
              {% for review in metaobject.reviews.value %}
                <div class="review">
                  {{ review.review_content | metafield_tag }}
                  <p class="reviewer-link">
                    {% unless review.link == blank %}
                      {% liquid
                        assign reviewer_link_url = ''
                        if review.link.value contains '?'
                          assign reviewer_link_url = review.link.value | append: '&' | append: utm_params_profile
                        else
                          assign reviewer_link_url = review.link.value | append: '?' | append: utm_params_profile
                        endif
                      %}
                      <a href="{{ reviewer_link_url }}" target="_blank">
                    {% endunless %}
                      {{ review.reviewer.value }}
                    {% unless review.link == blank %}</a>{% endunless %}
                  </p>
                </div>
              {% endfor %}
          </div>
        {% endif %}
        {% unless metaobject.other_links == blank %}
          <h3>Other Projects</h3>
          {{ metaobject.other_links | metafield_tag }}
        {% endunless %}
        {% if metaobject.industry_experience != blank %}
          <div class="profile-right--industries">
            <h3>Industry Experience</h3>
            <ul>
              {% for industry in metaobject.industry_experience.value %}
                <li>{{ industry }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      </div>
    </div>
  </section>
  <script>
    const Utils = {
      addClass: function(element, theClass) {
        element.classList.add(theClass);
      },
      removeClass: function(element, theClass) {
        element.classList.remove(theClass);
      },
      showMore: function(element, excerpt) {
        element.addEventListener("click", event => {
          const linkText = event.target.textContent.toLowerCase();
          event.preventDefault();
          if (linkText == "read more") {
            element.textContent = "Show less";
            this.removeClass(excerpt, "description--hidden");
            this.addClass(excerpt, "description--visible");
          } else {
            element.textContent = "Read more";
            this.removeClass(excerpt, "description--visible");
            this.addClass(excerpt, "description--hidden");
          }
        });
      }
    };
    const ExcerptWidget = {
      showMore: function(showMoreButtonTarget, excerptTarget) {
      const showMoreButton = document.querySelector(showMoreButtonTarget);
      if (!showMoreButton) return;
      const longDescription = showMoreButton.previousElementSibling;
      Utils.showMore(showMoreButton, longDescription);
      }
    };
    ExcerptWidget.showMore('.js-show-more', '.long-description');
  </script>

{% else %}
  <section>
    <h1 style="text-align: center;">Profile not found</h1>
  </section>
{% endif %}
{% schema %}
  {
    "name": "Member Profile",
    "settings": [],
    "presets": [
      {
        "name": "Member profile",
        "settings": {}
      }
    ]
  }
{% endschema %}
